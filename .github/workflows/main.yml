name: Build
on:
  push:
    branches:
      - master
  # ... (rest of your trigger configuration)
jobs:
  sonarqube:
    name: SonarQube
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # --- START: NEW STEP TO CREATE DUMMY COVERAGE FILE ---
      - name: Create Dummy Coverage XML (0% Coverage)
        id: create_dummy_report
        run: |
          # The Python scanner only needs this file to exist to proceed.
          # This minimal XML structure tells SonarQube where the source code is,
          # but since no <line-rate> or <class> data is included, it results in 0% coverage.
          echo '<?xml version="1.0" ?>' > coverage.xml
          echo '<coverage branch-rate="0" branches-covered="0" branches-valid="0" complexity="0" line-rate="0" lines-covered="0" lines-valid="0" timestamp="0" version="0">' >> coverage.xml
          echo '  <sources>' >> coverage.xml
          # Add the project directory path
          echo "    <source>${{ github.workspace }}</source>" >> coverage.xml
          echo '  </sources>' >> coverage.xml
          echo '  <packages/>' >> coverage.xml
          echo '</coverage>' >> coverage.xml
          cat coverage.xml # Print the file contents for verification in the logs
      # --- END: NEW STEP FOR DUMMY REPORT ---

      - name: SonarQube Scan
        uses: SonarSource/sonarqube-scan-action@v6
        with:
          args: >
            -Dsonar.python.coverage.reportPaths=coverage.xml
            -Dsonar.tests=tests/
            # Add this to avoid the error about no tests running
            -Dsonar.testExecutionReportPaths=dummy-test-report.xml
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
